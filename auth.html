<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–í—Ö–æ–¥ ‚Äî Life Architect</title>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

<style>
:root { --bg:#121212; --accent:#0A84FF; }
body {
    margin:0;
    font-family:-apple-system, sans-serif;
    background:var(--bg);
    color:white;
    display:flex;
    align-items:center;
    justify-content:center;
    height:100vh;
}
.auth-card {
    width:100%;
    max-width:360px;
    text-align:center;
    padding:20px;
}
.auth-logo {
    width:80px;
    height:80px;
    border-radius:20px;
    margin-bottom:20px;
}
.auth-input {
    width:100%;
    padding:16px;
    margin-bottom:12px;
    background:#1e1e1e;
    border:1px solid #333;
    border-radius:14px;
    color:white;
    font-size:16px;
    outline:none;
}
.auth-btn {
    width:100%;
    padding:16px;
    border-radius:14px;
    border:none;
    background:var(--accent);
    color:white;
    font-size:16px;
    font-weight:600;
    cursor:pointer;
    margin-bottom:12px;
}
.google-btn {
    background:white !important;
    color:black !important;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:10px;
}
.guest-btn {
    background:#2c2c2e !important;
}
.separator {
    margin:20px 0;
    font-size:12px;
    color:#666;
    display:flex;
    align-items:center;
}
.separator::before,
.separator::after {
    content:"";
    flex:1;
    height:1px;
    background:#333;
    margin:0 10px;
}
.auth-switch {
    color:var(--accent);
    margin-top:20px;
    cursor:pointer;
    font-size:14px;
}
</style>
</head>
<body>

<div class="auth-card">
    <img src="https://i.ibb.co/HyHNV5r/22222.png" class="auth-logo">
    <h1>Life Architect</h1>

    <!-- Google -->
    <button onclick="loginWithGoogle()" class="auth-btn google-btn">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18">
        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å Google
    </button>

    <!-- Guest -->
    <button onclick="loginAnonymously()" class="auth-btn guest-btn">
        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    </button>

    <div class="separator">–∏–ª–∏ –ø–æ—á—Ç–∞</div>

    <input type="email" id="auth-email" placeholder="Email" class="auth-input">
    <input type="password" id="auth-password" placeholder="–ü–∞—Ä–æ–ª—å" class="auth-input">

    <button onclick="handleAuth()" id="auth-submit" class="auth-btn">
        –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç
    </button>

    <p onclick="toggleAuthMode()" id="auth-switch" class="auth-switch">
        –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏
    </p>

    <div id="auth-error" style="color:#ff453a;margin-top:15px;font-size:13px;"></div>
</div>

<script>
/* üî• –í–°–¢–ê–í–¨ –¢–í–û–ô –†–ï–ê–õ–¨–ù–´–ô CONFIG –ò–ó index.html */
const firebaseConfig = {
    apiKey: "–¢–í–û–ô_API_KEY",
    authDomain: "–¢–í–û–ô_PROJECT.firebaseapp.com",
    projectId: "–¢–í–û–ô_PROJECT_ID",
    storageBucket: "–¢–í–û–ô_PROJECT.appspot.com",
    messagingSenderId: "–¢–í–û–ô_ID",
    appId: "–¢–í–û–ô_APP_ID"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let isLoginMode = false;

/* ============================= */
/* –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤         */
/* ============================= */
function toggleAuthMode() {
    isLoginMode = !isLoginMode;
    document.getElementById('auth-submit').innerText =
        isLoginMode ? '–í–æ–π—Ç–∏' : '–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç';

    document.getElementById('auth-switch').innerText =
        isLoginMode ? '–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è'
                    : '–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏';
}

/* ============================= */
/* Google –≤—Ö–æ–¥                  */
/* ============================= */
async function loginWithGoogle() {
    const provider = new firebase.auth.GoogleAuthProvider();
    try {
        const result = await auth.signInWithPopup(provider);
        await createUserDocIfNotExists(result.user);
    } catch (e) {
        showError(e.message);
    }
}

/* ============================= */
/* –ì–æ—Å—Ç–µ–≤–æ–π –≤—Ö–æ–¥ (Anonymous)    */
/* ============================= */
async function loginAnonymously() {
    try {
        const result = await auth.signInAnonymously();
        await createUserDocIfNotExists(result.user, true);
    } catch (e) {
        showError(e.message);
    }
}

/* ============================= */
/* Email / Password             */
/* ============================= */
async function handleAuth() {
    const email = document.getElementById('auth-email').value;
    const pass = document.getElementById('auth-password').value;

    if (!email || !pass) {
        showError("–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å");
        return;
    }

    try {
        let userCredential;

        if (isLoginMode) {
            userCredential =
                await auth.signInWithEmailAndPassword(email, pass);
        } else {
            userCredential =
                await auth.createUserWithEmailAndPassword(email, pass);
        }

        await createUserDocIfNotExists(userCredential.user);
    } catch (e) {
        showError(e.message);
    }
}

/* ============================= */
/* –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ Firestore */
/* ============================= */
async function createUserDocIfNotExists(user, isGuest=false) {
    const docRef = db.collection('users').doc(user.uid);
    const doc = await docRef.get();

    if (!doc.exists) {
        await docRef.set({
            name: "",
            lvl: 1,
            xp: 0,
            goals: [],
            guest: isGuest,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
    }
}

/* ============================= */
/* –ê–≤—Ç–æ-—Ä–µ–¥–∏—Ä–µ–∫—Ç                */
/* ============================= */
auth.onAuthStateChanged((user) => {
    if (user) {
        window.location.href = "index.html";
    }
});

/* ============================= */
function showError(msg) {
    document.getElementById('auth-error').innerText = msg;
}
</script>

</body>
</html>
